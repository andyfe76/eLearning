<?php
/****************************************************************/
/* klore														*/
/****************************************************************/

$_include_path = '../include/';
require ($_include_path.'vitals.inc.php');
require ($_include_path.'header.inc.php');

$_section[0][0] = $_template['tools'];
$_section[0][1] = 'tools/';
$_section[1][0] = $_template['feedback'];

//ToDo : If CourseOwner do not allow to send feedback.
//			Daca instructorii sunt incrisi la cursuri se poate verifica dupa $_SESSION['is_admin'] ?
//			else cu selsct pe courses.
if (($_SESSION['c_instructor'])||($_SESSION['is_admin'])|| ($_SESSION['is_super_admin']))
		{
		
		/*$sumq1=0;
		$sumq2=0;
		$sumq3=0;
		$sql='SELECT * FROM user_feedback WHERE course_id='.$_SESSION['course_id'];
		$result=$db->query($sql);
		while($row=$result->fetchRow())
		{
			$sumq1+=intval($row[2]);
			$sumq2+=intval($row[3]);
			$sumq3+=intval($row[4]);
			//$sumq4.='<tr><td>'.$row[4].'</td></tr>';//text answers.				
		}
		$sql='SELECT COUNT(member_id) FROM user_feedback WHERE course_id='.$_SESSION['course_id'];
		$result=$db->query($sql);
		$row=$result->fetchRow(); 
		if ($row[0]>0)
		{
			$answ_text[-2]='Worst';
			$answ_text[-1]='Bad';
			$answ_text[0] ='Average';
			$answ_text[1] ='Good';
			$answ_text[2] ='Very Good';
			
		echo '<br>Q1 Average answer : '.($answ_text[round($sumq1/$row[0])]);	
		echo '<br>Q2 Average answer : '.($answ_text[round($sumq2/$row[0])]);
		echo '<br>Q3 Average answer : '.($answ_text[round($sumq3/$row[0])]);
		//echo '<table border="1" cellpadding="0" cellspacing="0" bordercolor="#CCCCCC" bgcolor="#f3f3f3">'.$sumq4.'</table>';	
		
		
			
		}
		else print_errors('No feedback for this course');
		*/
		
		include('preview.inc.php');
		echo '<br><br><a href="feedback/questions.php">Edit Questions</a>'; 
	}
else//Normal users
{
	$_include_path	='../include/';
	$_section = 'feedback';

	if ($_POST['add_feedback'])	{
		$fquestion[1]=intval($_POST['q1']);
		$fquestion[2]=intval($_POST['q2']);
		$fquestion[3]=intval($_POST['q3']);
		$member_id=$_SESSION['member_id'];
		$course_id=$_SESSION['course_id'];

		//check if already submited;
		$sql='SELECT COUNT(member_id) from user_feedback where member_id='.$member_id.' and course_id='.$course_id;
		$result=$db->query($sql);
		$count0 = $result->fetchRow();
		if ($count0[0]>0) {
			print_errors('You have already sent a feedback for this course.');//ToDo -> template
		} else {
			$sql="INSERT INTO user_feedback ( course_id , member_id , q1 , q2 , q3 ) 
				VALUES ( $course_id, $member_id, 
				'".$fquestion[1]."', 
				'".$fquestion[2]."', 
				'".$fquestion[3]."')
			";
			$result=$db->query($sql);
			print_feedback('Your Feedback has been succesfuly added to our DataBase ');//ToDo -> template
			require ($_include_path.'footer.inc.php');
			exit;
		} 
	}
	
	print_feedback($feedback);
?>
<br><br>
<h3><?php echo $_template['feedback']; ?></h3>
<p></p>
<br />

<table border="1" cellpadding="0" cellspacing="0" bordercolor="#CCCCCC" bgcolor="#f3f3f3">
  <tr>
    <td width="117"><div align="center"><strong>Feedback</strong> </div></td>
  </tr>
</table>
<br>
<form name="form1" method="post" action="<?php echo $PHP_SELF ?>">
  <table width="100%" border="1" cellpadding="0" cellspacing="0" bordercolor="#CCCCCC" bgcolor="#f3f3f3">
    <tr> 
      <td width="50%" valign="top">What is your oppinion about this course ?</td>
      <td width="50%"> <select name=q1>
          <option value=2>Excelent,Smashing,Super</option>
          <option value=1>Good</option>
          <option value=0 selected>Average</option>
          <option value=-1>Bad</option>
          <option value=-2>Worst Course I`ve ever seen</option>
        </select> </td>
    </tr>
    <tr> 
      <td width="50%" valign="top">What do you think about the teacher ?</td>
      <td><select name=q2 id="q2">
          <option value="2">Genius</option>
          <option value="1">Good</option>
          <option value="0" selected>Average</option>
          <option value="-1">Bad</option>
          <option value="-2">Very bad</option>
        </select></td>
    </tr>
    <tr> 
      <td width="50%" height="27" valign="top">.. And about you ?</td>
      <td><select name=q3 id="q3">
          <option value=2>Genius</option>
          <option value=1>Good</option>
          <option value=0 selected>Average</option>
          <option value=-1>Bad</option>
          <option value=-2>Nightmare</option>
        </select></td>
    </tr>
    <tr> 
      <td width="50%">&nbsp;</td>
      <td><input type="submit" name="add_feedback" class="button" value="Feedback"></td>
    </tr>
  </table>
</form>

<?php
}//else if not admin
	require($_include_path.'footer.inc.php');
?>